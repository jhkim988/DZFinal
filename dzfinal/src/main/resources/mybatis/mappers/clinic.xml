<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.douzone.dzfinal.repository.ClinicRepository">
	<resultMap id="clinicMap" type="com.douzone.dzfinal.dto.ClinicResponse$Clinic">
		<association property="drug_takingList" column="patient_id" select="getDrugList"/>
		<association property="underlyingList" column="patient_id" select="getDiseaseList"/>
	</resultMap>
	<select id="getClinic" resultMap="clinicMap">
	    SELECT
			r.reception_id reception_id,
			p.patient_id patient_id,
			p.patient_name patient_name,
	    	p.front_registration_number front_registration_number,
	    	p.back_registration_number back_registration_number,
	    	r.systolic systolic,
			r.diastolic diastolic,
	    	r.blood_sugar blood_sugar,
			r.height height,
			r.weight weight,
			r.bmi bmi
	    FROM Reception r inner join Patient p on r.patient_id = p.patient_id
	    WHERE reception_id = #{reception_id}
	</select>
	
	<select id="getDrugList" resultType="com.douzone.dzfinal.dto.ClinicResponse$DrugTaking">
		SELECT
			d.drug_id drug_id,
			d.drug_code drug_code,
			d.drug_name drug_name,
			dt.patient_id patient_id
		FROM Drug_Taking dt
			inner join Drug d on dt.drug_id = d.drug_id
		WHERE dt.patient_id = #{patient_id}
	</select>
	
	<select id="getDiseaseList" resultType="com.douzone.dzfinal.dto.ClinicResponse$Underlying">
		SELECT
			d.disease_code disease_code,
			d.disease_name disease_name,
			u.patient_id patient_id
		FROM Underlying u
			inner join Disease d on u.disease_id = d.disease_id
		WHERE u.patient_id = #{patient_id};
	</select>
</mapper>