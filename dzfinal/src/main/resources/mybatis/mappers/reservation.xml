<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.douzone.dzfinal.repository.ReservationRepository">
    <select id="monthList" resultType="com.douzone.dzfinal.dto.ReservationResponse$Month">
        select
            `reservation_id`,
            `patient_name`,
            `doctor`, count(*) as `count`,
            `wish_date`,
            `wish_time`,
            `treatment_reason`
        from Reservation
            where wish_date between #{start} and #{end} and state in ('예약중', '완료')
        group by `wish_date`, `doctor`;
    </select>
    <select id="weekList" resultType="com.douzone.dzfinal.dto.ReservationResponse$Week">
select
`reservation_id`,
`patient_name`,
`doctor`,
`wish_date`,
`wish_time`,
count(*) as `count`,
`treatment_reason`
from Reservation
where wish_date BETWEEN #{start} AND #{end} and state in ('예약중', '완료')
group by `wish_date`, HOUR(`wish_time`), `doctor`
    </select>
    <select id="dayList" resultType="com.douzone.dzfinal.dto.ReservationResponse$Day">
        select
            `reservation_id`,
            `patient_name`,
            `wish_date`,
            `wish_time`,
            `doctor`,
            `treatment_reason`
        from Reservation
        where Reservation.wish_date=#{target} and state in ('예약중', '완료')
    </select>
    <select id="findOneById" resultType="com.douzone.dzfinal.entity.Reservation">
        select `reservation_id`, `patient_id`, `patient_name`, `phone_number1`, `phone_number2`, `phone_number3`,
        `wish_date`, Reservation_Time_Code.`time` as time, `treatment_reason`, `state`, `employee_name`
        from Reservation
        join Reservation_Time_Code on Reservation.time_code = Reservation_Time_Code.id
        join Employee on Reservation.doctor = Employee.employ_id
        where reservation_id = #{reservation_id}
    </select>
</mapper>